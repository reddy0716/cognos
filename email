set -e
    cd MotioCI/api/CLI
    TOKEN=$(python3 ci-cli.py --server="$MOTIO_SERVER" --non-interactive login --credentialsFile "$CREDENTIALS_FILE" | tail -n 1 | tr -d "\\r")
    # Fail if empty
    if [ -z "$TOKEN" ]; then
      echo "Login produced empty token" >&2
      exit 1
    fi
    # Fail if token still contains whitespace/newlines (safety)
    if echo "$TOKEN" | grep -q "[[:space:]]"; then
      echo "Token contains whitespace/newlines; refusing to continue" >&2
      echo "Raw token was: =====" >&2
      echo "$TOKEN" >&2
      echo "=====" >&2
      exit 1
    fi
    echo "$TOKEN"
  ''',
  returnStdout: true
).trim()
echo "MotioCI login completed - token captured."
