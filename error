stage('Get camPassportIds') {
  steps {
    container('python') {
      script {
        env.DEVTEST_PASSPORT = sh(
          script: """
            cd MotioCI/api/CLI
            python3 session.py ${DEVTEST_URL} --credentialsFile devtest-credentials.json
          """,
          returnStdout: true
        ).trim()

        env.PROD_PASSPORT = sh(
          script: """
            cd MotioCI/api/CLI
            python3 session.py ${PROD_URL} --credentialsFile prod-credentials.json
          """,
          returnStdout: true
        ).trim()

        if (!env.DEVTEST_PASSPORT) {
          error("❌ DevTest camPassportId is empty! Check devtest-credentials.json or API key.")
        } else {
          echo "✅ DevTest camPassportId captured: ${env.DEVTEST_PASSPORT.take(15)}..."
        }

        if (!env.PROD_PASSPORT) {
          error("❌ Prod camPassportId is empty! Check prod-credentials.json or API key.")
        } else {
          echo "✅ Prod camPassportId captured: ${env.PROD_PASSPORT.take(15)}..."
        }
      }
    }
  }
}
